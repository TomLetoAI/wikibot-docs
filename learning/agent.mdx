---
title: "Агенты"
description: "Настройте поведение бота"
---

## Общая информация 
Агенты умеет вести полноценный диалог с пользователем с поддержкой истории сообщений, ищет данные по базе знаний, Первой линии и задаёт дополнительные вопросы пользователю.

При получении запроса от пользователя агент в первую очередь проверяет наличие ответа в Первой линии.

Стоимость обработки сообщений агентом не фиксирована, а варьируется от количества действий, совершенных агентом для ответа. За каждое действие агента, требующее обращение к ИИ, взымается 1 кредит.

<Note>
  Если у вашего бота нет первой линии, то агент не будет искать ответы в ней.
  Соответственно это может снизить стоимость обработки отдельного сообщения на 1
  кредит
</Note>

## Настройка инструкции

    Используйте настройку инструкции, чтобы ознакомить агента с вашей предметной областью, задать стиль общения и сценарии его работы.
    Для хорошего описания инструкции следуйте общим правилам написания инструкций к ЛЛМ:

1. Четкая инструкция: Убедитесь, что инструкция устанавливает четкую роль для агента. Это должно хорошо объяснять, что от бота ожидают пользователи.

<Note>Ты менеджер по продажам туристического агентсва.</Note>

2. Структурированные инструкции: Ваши инструкции должны включать четкие, корректные и последовательные правила для агента, чтобы улучшить его реакцию на разные запросы.

<Note>
Если пользователь обращается с просьбой найти тур, то следуй сценарию "Поиск тура"

Сценарий "Поиск тура":

1. Уточни город вылета и желаемое направление
2. Для поиска тура используй запрос формата: Поиск тура "Город вылета" / "Город или страна прилета" \*
3. При первом поиске тура не уточняй дополнительные детали
4. Предоставляй туры в виде структурированного списка:
   - Город вылета
   - Город прилета
   - Дата вылета и кол-во ночей
   - Цена
   - Ссылка на тур
5. Если пользователь выбирает тур, то собери данные о туристах: ФИО, номер телефона, кол-во туристов
6. Когда все данные собраны, то переведи диалог на оператора

_В данном примере задается формат, в котором агент будет искать туры по Базе знаний. "Поиск тура" позволяет агенту выбрать документ с заголовком "Поиск тура", который должен содержать информацию о доступных турах._

  </Note>

3. Предусмотрение направлений разговора: Важно предусмотреть потенциальные направления диалога и сценарии ошибок.
   Если вы пишите агенту какое-то условие, то важно описать оба варианта действий: когда условие выполняется и когда не выполняется.

<Note>
  Если тур не найден, не говори что нет подходящих туров. Переведи на оператора
  и скажи, что оператор обязательно поможет найти.
</Note>

4. Гибкость в ответах: Хорошая инструкция допускает гибкость в ответах агента, чтобы обеспечить более естественное взаимодействие с пользователем.

<Note>Не повторяй свой предыдущий ответ с подобранными турами.</Note>

5. Используйте специфические примеры: Предоставляйте конкретные примеры ожидаемого поведения в ваших инструкциях, чтобы убедиться, что агент понимает, как должен выглядеть его ответ.

<Note>
  Пример диалога: - тур - Добрый день, подскажите из какого города планируется
  вылет и какое направление Вас интересует? - Турция из Москвы - _примеры
  туров...._ - Спасибо, я выберу первый - Отлично, скажите Ваши ФИО и номер
  телефона, чтобы я мог забронировать тур для вас - ...
</Note>

## Вызов функций внешних API

Агент может вызывать пользовательские функции с помощью http-запросов. Например, агент может уточнить у пользователя номер заказа, вызвать http-метод
`https://endpoint/api/get_order=1` и предоставить пользователю информацию о его заказе.

Агент поддерживает GET и POST запросы. Для POST запросов тело запроса должно быть `application/json`. Поддерживается передача заголовков, в том числе и `Authorization`.

На данный момент мы не поддерживаем настройку на портале, напишите [нам](https://t.me/use_wikibot) для включения и настройки.

## Ограничения

    - На данный момент агент получает около 10 последних сообщений с пользователем, значение может изменяться как в меньшую так и в большую сторону.
    - Агент не знает текущую дату и время.
    - Для ответа на вопрос агенту доступны данные из базы знаний, которые он искал в последний раз, данные из предыдущих поисков он "забывает".
    - Агент не умеет считывать информацию с каких-либо сайтов (переходить по URL), кроме той, что добавлена в Базу знаний.

## Полезные приёмы

- Если необходимо, чтобы бот отвечал по какой-то теме на основе своих общих знаний, то можно использовать инструкцию вида:
  `Если пользователь спрашивает про <ваша тема>, то ты можешь использовать свои общие знания, для таких вопросов не ищи в первой линии или в базе знаний, сразу отвечай, то, что ты знаешь.`

## Навыки

На данный момент для настройки доступны два навыка - `Фильтрация` и `Выбор исполнителя`. Вы можете в любое время включать\выключать данные навыки, а также дописывать необходимые правила для них.

### Фильтрация
Навык фильтрации позволяет пропускать сообщения, которые предположительно содержат спам или не должны обрабатываться вообще. Необходимо описать правила - какие сообщения относятся к спаму. После чего
бот будет игнорировать все подходящие под условия сообщения. Остальные сообщения проходят на дальнейшую обработку.

Стоимость успешной фильтрации одного спам-сообщения 0.1 кредита. Вы можете настроить и включить данный навык на вкладке Фильтрация на странице Агенты.

Пример настройки навыка:
```
Правила "Спам":
  - Если это рекламный пост, рассылка - спам.
  - Если сообщение состоит только из эмодзи - спам.

Все остальные сообщения, не подходящие под правила - не спам.
```

### Выбор исполнителя
Навык выбора исполнителя позволяет настроить правила для перевода на оператора, т.е. ограничить темы, по которым бот будет отвечать. Настройка работает по аналогии с навыком фильтрации.

Стоимость успешного срабатывания данного навыка в случае перевода на оператора - 0.2 кредита.

Пример настройки навыка:
```
Если вопрос касается оплаты, переводи на оператора. 

Все остальные вопросы переводи на бота.
```

## Настройки агента

<AccordionGroup>
  <Accordion title="Дата и время">
Агенту становятся доступны текущие дата и время. Может использоваться в сценариях, где необходимо отфильтровать данные из контекста по дате.
  </Accordion>
<Accordion title="Случайное число">
  Агенту доступно случайное число. На каждое диалоговое сообщение создается новое случайное число от 1 до 1000. 
  Может использоваться в сценариях, где необходим выбор случайного действия. Например, `Используй случайное число % 5, чтобы выбрать ответ клиенту в качестве благодарности: 1. Спасибо за ваш отзыв! 2. Спасибо, что вы с нами! ...`
</Accordion>

  <Accordion title="Уточняющие вопросы">
    Агент может задавать уточняющие вопросы. Отключите, если агент должен сразу генерировать ответ или переводить на оператора.
  </Accordion>
    <Accordion title="Сообщение при переводе">
    По умолчанию, при переводе на оператора, используется сообщение из шаблона перевода на оператора, доступного в настройках бота.
    При включении данной настройки, можно указать в инструкции агента сообщение, с которым агент переведет на оператора. Например, `Собрав контактные данные клиента, переведи на оператора и ответь
    "Спасибо за ваш заказ, сообщим о готовности."`
  </Accordion>
     <Accordion title="Раздельные документы">
    Агент будет генерировать ответ не по всем найденным документам, а только по одному из найденных. 
    Можно использовать в случаях, когда недопустимо смешивание инструкций из разных документов.
  </Accordion>
</AccordionGroup>

## Тестирование

На странице Агенты также доступен функционал по клонированию и удалению агентов. Данная функция позволяет улучшать и тестировать инструкцию и навыки, не влияя на текущих клиентов.

Как лучше всего тестировать агента:
1) Клонируйте текущего агента;
2) Внесите изменения в навыки, инструкцию или настройки;
3) Перейдите на вкладку тестирование, выберите нового агента и оцените результаты исправлений;
4) Если все отлично, вы можете включить нового агента в работу, старый агент будет выключен автоматически.
