---
title: "Обучение"
description: "Обучение бота вашей базой знаний"
---

<img src="/images/lk-l1-list.jpg" alt="l1 list" />

## Агенты

Агенты позволяют вести полноценный диалог с пользователем с поддержкой истории сообщений.
Агент умеет искать данные по базе знаний, Первой линии и задавать дополнительные вопросы пользователю.

При получении запроса от пользователя агент в первую очередь проверяет наличие ответа в Первой линии.

Стоимость обработки сообщений агентом не фиксирована, а варьируется от количества действий, совершенных агентом для ответа. За каждое действие агента, требующее обращение к ИИ, взымается 1 кредит.

<Note>
  Если у вашего бота нет первой линии, то агент не будет искать ответы в ней.
  Соответственно это может снизить стоимость обработки отдельного сообщения на 1
  кредит
</Note>

### Настройка роли

    Используйте настройку роли, чтобы ознакомить агента с вашей предметной областью, задать стиль общения и сценарии его работы.
    Для хорошего описания роли следуйте общим правилам написания инструкций к ЛЛМ:

1. Четкая роль: Убедитесь, что инструкция устанавливает четкую роль для агента. Это должно хорошо объяснять, что от бота ожидают пользователи.

<Note>Ты менеджер по продажам туристического агентсва.</Note>

2. Структурированные инструкции: Ваши инструкции должны включать четкие, корректные и последовательные правила для агента, чтобы улучшить его реакцию на разные запросы.

<Note>
Если пользователь обращается с просьбой найти тур, то следуй сценарию "Поиск тура"

Сценарий "Поиск тура":

1. Уточни город вылета и желаемое направление
2. Для поиска тура используй запрос формата: Поиск тура "Город вылета" / "Город или страна прилета" \*
3. При первом поиске тура не уточняй дополнительные детали
4. Предоставляй туры в виде структурированного списка:
   - Город вылета
   - Город прилета
   - Дата вылета и кол-во ночей
   - Цена
   - Ссылка на тур
5. Если пользователь выбирает тур, то собери данные о туристах: ФИО, номер телефона, кол-во туристов
6. Когда все данные собраны, то переведи диалог на оператора

_В данном примере задается формат, в котором агент будет искать туры по Базе знаний. "Поиск тура" позволяет агенту выбрать документ с заголовком "Поиск тура", который должен содержать информацию о доступных турах._

  </Note>

3. Предусмотрение направлений разговора: Важно предусмотреть потенциальные направления диалога и сценарии ошибок.
Если вы пишите агенту какое-то условие, то важно описать оба варианта действий: когда условие выполняется и когда не выполняется.

<Note>
  Если тур не найден, не говори что нет подходящих туров. Переведи на оператора
  и скажи, что оператор обязательно поможет найти.
</Note>

4. Гибкость в ответах: Хорошая роль допускает гибкость в ответах агента, чтобы обеспечить более естественное взаимодействие с пользователем.

<Note>Не повторяй свой предыдущий ответ с подобранными турами.</Note>

5. Используйте специфические примеры: Предоставляйте конкретные примеры ожидаемого поведения в ваших инструкциях, чтобы убедиться, что агент понимает, как должен выглядеть его ответ.

<Note>
  Пример диалога: - тур - Добрый день, подскажите из какого города планируется
  вылет и какое направление Вас интересует? - Турция из Москвы - _примеры
  туров...._ - Спасибо, я выберу первый - Отлично, скажите Ваши ФИО и номер
  телефона, чтобы я мог забронировать тур для вас - ...
</Note>


### Вызов функций внешних API

Агент может вызывать пользовательские функции с помощью http-запросов.  Например, агент может уточнить у пользователя номер заказа, вызвать http-метод
`https://endpoint/api/get_order=1` и предоставить пользователю информацию о его заказе.

Агент поддерживает GET и POST запросы. Для POST запросов тело запроса должно быть `application/json`. Поддерживается передача заголовков, в том числе и `Authorization`.

На данный момент мы не поддерживаем настройку на портале, напишите [нам](https://t.me/use_wikibot) для включения и настройки.

### Ограничения

    - На данный момент агент получает около 10 последних сообщений с пользователем, значение может изменяться как в меньшую так и в большую сторону.
    - Агент не знает текущую дату и время.
    - Для ответа на вопрос агенту доступны данные из базы знаний, которые он искал в последний раз, данные из предыдущих поисков он "забывает".
    - Агент не умеет считывать информацию с каких-либо сайтов (переходить по URL), кроме той, что добавлена в Базу знаний.

### Полезные приёмы

- Если необходимо, чтобы бот отвечал по какой-то теме на основе своих общих знаний, то можно использовать инструкцию вида:
  `Если пользователь спрашивает про <ваша тема>, то ты можешь использовать свои общие знания, для таких вопросов не ищи в первой линии или в базе знаний, сразу отвечай, то, что ты знаешь.`

### Спам-агент

Спам-агент позволяет пропускать сообщения, которые предположительно содержат спам. Необходимо описать агенту правила - какие сообщения относятся к спаму. После чего
он будет все подходящие под условия сообщения помечать как спам. Остальные сообщения проходят на дальнейшую обработку. 
Стоимость успешной фильтрации одного спам-сообщения 0.1 кредита.
На данный момент мы не поддерживаем включение спам-агента на портале, но вы можете написать [нам](https://t.me/use_wikibot) для его включения.

### Агент для перевода на оператора

Данный агент позволяет настроить правила для перевода на оператора. Настройка работает по аналогии со спам-агентом. 
Стоимость одного перевода на оператора - 0.2 кредита.
На данный момент мы не поддерживаем включение этого агента на портале, но вы можете написать [нам](https://t.me/use_wikibot) для его включения.

## База знаний

<img src="/images/lk-dataset-overview.jpg" alt="dataset" />

В этом разделе осуществляется работа с данными, по которым бот будет строить ответ.

Для добавления новых данных нажмите **Добавить**.

### Добавление веб-сайта

Для добавления веб-сайта необходимо указать адрес сайта и выбрать парсер.

Парсер по умолчанию подходит для большинства веб-сайтов. Также доступны парсеры, подходящие под конкретные платформы, например Google Sheets или Notion.

Можно выбрать стратегию обхода веб-сайта:

- Весь сайт - парсинг всех страниц с тем же доменом.
- Одна страница - парсинг только этой страницы.
- Папка - парсинг всех страниц, которые начинаются также, как заданный URL.

### Документ Google Sheet

Документ Google Sheet должен содержать два столбца:

- первый столбец - заголовок статьи;
- второй столбец - тело статьи.

Таким образом, каждая строка документа - это как одна статья в базе знаний.

### Сайты и html страницы, опубликованные google документы

Страницы разбиваются на части (фрагменты) по заголовкам h1, h2, ...
Например, для такой структуры статьи:

> <h1>Главный заголовок</h1>
> Общие данные
> <h2>подзаголовок 1</h2>
> Данные 1<h2>подзаголовок 2</h2>
> Данные 2

получится 3 чанка,

1. title = h1, headings = [h1], content = "Общие данные"
2. title = h1, headings = [h1, h2], content = "Данные 1"
3. title = h1, headings = [h1, h2], content = "Данные 2"

Это важно учитывать при написании страниц, т.к. при поиске ответов Wikibot ищет фрагменты похожие на вопрос пользователя.
Если фрагменты будут очень маленькие, то каждый из них не будет содержать всего ответа.

<Tip>
  Если у вас нет Базы знаний, то самым простым вариантом обучения бота будет
  создать Google документ. Опишите в нем всё, что должен знать бот. Обязательно
  добавьте стили заголовков для смысловых групп. Опубликуйте документ `Файл ->
  Поделиться -> Опубликовать в интернете`. Используйте полученную ссылку для
  добавления источника данных.
</Tip>

### Добавление файла

<img src="/images/lk-dataset-add-file.jpg" alt="lk-dataset-add-file" />

Добавление текстовых данных из файла. На данный момент поддерживаются форматы pdf и docx.

<Tip>
  Для лучшей индексации docx для всех смысловых заголовков в вашем тексте
  рекомендуется использовать стили Заголовок 1, Заголовок 2, Заголовок 3
  (Heading 1, Heading 2, Heading 3).
</Tip>

После добавления файла он будет автоматически проиндексирован.

Максимальный размер файла - 10 МБ.

Для каждого типа файлов автоматически создается один источник данных:

- PDF
- DOCX

### Добавление произвольных данных

Укажите заголовок и произвольные текстовые данные, нажмите добавить. Данные будут автоматически добавлены в индекс бота.
Также автоматически будет создан источник данных - PRIVATEDATA.

## Первая линия

**Вопрос-ответ** или **Первая линия** или **L1** — точные ответы без изменения формулировок в стиле FAQ, либо перевод на оператора по вопросам,
которые требуют участия человека.

Если срабатывает Первая линия, то пользователь получает заранее готовый ответ или автоматическое переключение на оператора.

<Check>
  Первая линия отлично подходит для тем, где нужно отвечать строго по
  регламенту.
</Check>

<Check>
  Первую линию нужно использовать для переключения на оператора в чувствительных
  темах, например возвраты или удаление данных.
</Check>

### Добавление

Для добавления ответа нажмите **Добавить** в правом верхнем углу.

L1 состоит из **Главного вопроса** и **Похожих вопросов**. Для каждого вопроса задается один из двух вариантов: переключение на оператора или ответ, в зависимости от выбранного действия.

<img src="/images/lk-l1-new.jpg" alt="l1 new" />

<Tip>
  **Главный вопрос** должен быть довольно узким, иначе он будет срабатывать
  очень часто.
</Tip>

<Tip>
  Чтобы бот лучше понимал **Главный вопрос** необходимо задать его
  дополнительные формулировки — **Похожие вопросы**, но не больше 10 на 1
  основной.
</Tip>

<Tip>
  Похожие вопросы можно сгенерировать автоматически. После нажатия
  **Сгенерировать** приложение автоматически создаст до пяти похожих вопросов.
  Данная функция тратит 0.1 кредита за одно нажатие.
</Tip>

Тестировать **Первую линию** удобно на портале в разделе [Тестирование](/lk/testing). Вы сможете увидеть сработала или нет Первая линия и понять, почему.

[Дополнительные рекомендации о настройке Первой линии](/guides/bot-doesnt-answer#keys-2-nuzhnaya-pervaya-liniya-ne-srabotala).

Также для добавления **Первой линии** вы можете воспользоваться генерацией. Для этого нажмите **Сгенерировать** в правом верхнем углу. В открывшемся окне вы можете сгенерировать первую линию на основе одного из источников:

- файл;
- Google Sheets;
- описание.

<img src="/images/lk-l1-generate.jpg" alt="lk-l1-generate" />

Кроме того, вопросы и ответы для **Первой линии** можно сгенерировать на [основе статьи базы знаний](/lk/learn#generatsiya-voprosov-i-otvetov).

#### Генерация на основе файла или Google Sheets

Для загрузки списка вопросов и ответов предоставьте документ в виде файла в формате **XLSX** или **CSV** или ссылки на **Google Sheets**.

<Tip>
  Если вы выбираете загрузку из **Google Sheets**, убедитесь, что указанный
  документ доступен для общего доступа всем пользователям.
</Tip>

Документ должен содержать два столбца:

- первый столбец - вопрос;
- второй столбец - ответ.

После нажатия кнопки **Продолжить**, ваш документ будет отправлен на обработку. Для каждого вопроса будут сгенерированы 3 похожих вопроса. Стоимость генерации каждой тройки вопросов составляет **0.1 кредита**. Во время процесса генерации будет показан желтый баннер загрузки.

<img src="/images/lk-l1-generate-ready.jpg" alt="lk-l1-generate-ready" />

По завершении процесса на этом баннере появится кнопка **Просмотреть**, которая перенаправит вас на страницу с итоговым списком вопросов и ответов, где вы сможете добавить их в **Первую линию**.

<img src="/images/lk-l1-generate-apply.jpg" alt="lk-l1-generate-apply" />

#### Генерация на основе описания

Укажите 3 основных вопроса в вашу службу технической поддержки, а также описание вашего бизнеса. При нажатии на **Продолжить** будут сгенерированы дополнительные 7 вопросов, а также по 3 похожих вопроса для каждого из 10 основных вопросов. Стоимость такой генерации составляет **5 кредитов**.
По завершении генерации будет показан итоговый список вопросов с возможностью добавить их в **Первую линию**.

## Работа с индексом

**Индекс** представляет собой набор всех данных, доступных боту для генерации ответа.

Удаление отдельных веб-страниц из индекса невозможно, так как они будут перекачены при следующей перезагрузке веб-сайта. Если какая-то страница является нежелательной,
то её можно исключить из индекса. Для этого установите галочку напротив этой страницы и нажмите **Удалить из индекса**. **Добавить в индекс** вернет удаленные страницы обратно в индекс.

Вы можете перезагрузить отдельные веб-страницы, если внесли в них какие-то изменения. Для этого поставьте галочки напротив нужных страниц и нажмите **Перезагрузить страницы**.

## Работа со страницами

Справа от каждой загруженной страницы есть меню, через которое можно добавить дополнительный 
контент для [лучшего поиска](/guides/bot-doesnt-answer#keys-3-bot-ne-nashel-nuzhnuyu-statyu-v-kotoroy-est-otvet) страницы, 
а также сгенерировать вопросы и ответы для [Первой линии](/lk/learn#pervaya-liniya).

### Дополнительный контент

Если перейти к просмотру фрагментов данных по странице, то появится возможность добавить дополнительный контент на страницу.

Для этого нажмите кнопку **Добавить контент**.

<img
  src="/images/lk-dataset-add-additional-content.jpg"
  alt="lk-dataset-add-additional-content"
/>

Дополнительный контент добавляется в начало **каждого** фрагмента и позволяет точнее находить статью по время генерации ответа.

### Генерация вопросов и ответов

Вы можете сгенерировать вопросы и ответы для [Первой линии](/lk/learn#pervaya-liniya) на основе содержимого страницы. Для этого на странице просмотра нажмите **Сгенерировать интенты**.

В зависимости от содержимого страницы будет сгенерировано до 10 вопросов и ответов. Стоимость такой генерации составляет **1 кредит**.

Во время процесса генерации будет показан желтый баннер загрузки. По завершении процесса на этом баннере появится кнопка **Просмотреть**, которая перенаправит вас на страницу с итоговым списком вопросов и ответов, где вы сможете добавить их в **Первую линию**.

<img src="/images/lk-dataset-generate-l1.jpg" alt="lk-dataset-generate-l1" />

## Управление источниками данных

<img
  src="/images/lk-dataset-edit-datasource.jpg"
  alt="lk-dataset-edit-datasource"
/>

Нажмите **Редиктировать источники данных**, чтобы посмотреть все подключенные источники данных.

В этом окне вы можете удалить, перезагрузить или скопировать источник данных.

<Warning>
  Удаление источника данных удалит все связанные с ним страницы данных из
  индекса. Например, удаление источника данных PDF удалит все загруженные файлы
  формата pdf.
</Warning>

    ## Глоссарий

Глоссарий позволяет улучшить поиск данных в базе знаний во время ответов на вопросы пользователей. В левой части необходимо указать термин, который используется в вашей документации.
В правой части указываются все варианты этого термина (через запятую), которые могут использовать пользователи.

<Note>
  Например, в базе знаний у вас используется термин `АЗС`, в этом случае в
  правой части можно указать `заправка, автозаправочная станция, бензоколонка`
</Note>

В дальнейшем, во время индексации вопросов Первой линии и данных из Базы знаний все термины из глоссария дополняются его вариациями.

<Note>
  Например, если у вас в Первой линии есть вопрос `Адреса АЗС?`, то после
  индексации он станет `Адреса АЗС (заправка, автозаправочная станция,
  бензоколонка)?`
</Note>

## Фразы

**Фразы** позволяют расширить стандартные наборы для определения приветствий, благодарностей и пропусков.
Каждая из фраз должна быть расположена в отдельной строке.

### Алгоритм работы приветствий

Из сообщения пользователя удаляются все приветствия, если длина итогового сообщения становится меньше трех символов, то всё сообщение рассматривается как приветсвие.

### Алгоритм работы благодарностей

Из сообщения пользователя удаляются все благодарности и знаки препинания, если длина итогового сообщения становится меньше 26 символов (5 символов, если включен агент), то всё сообщение рассматривается как благодарность.

### Алгоритм работы пропусков

Из сообщения пользователя удаляются все фразы пропусков, если итоговое сообщение становится пустой строкой, то всё сообщение пропускается и не обрабатывается.
